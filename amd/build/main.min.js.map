{"version":3,"file":"main.min.js","sources":["../src/main.js"],"sourcesContent":["import $ from \"jquery\";\nimport ModalFactory from \"core/modal_factory\";\nimport ModalEvents from \"core/modal_events\";\nimport { get_string } from \"core/str\";\n\nexport const init = async () => {\n  let api_key;\n  await get_string(\"api_token\", \"local_student\").then((data) => {\n    api_key = data;\n  });\n  $(\".local_student--delete\").on(\"click\", (e) => {\n    let id = Number.parseInt(e.target.text.split(\"-\")[1]);\n\n    ModalFactory.create({\n      type: ModalFactory.types.SAVE_CANCEL,\n      title: \"Confirm delete\",\n      body: \"Do you want to delete this record?\",\n    }).then((modal) => {\n      modal.setSaveButtonText(\"Delete\");\n      let root = modal.getRoot();\n\n      root.on(ModalEvents.save, () => {\n        let wsfunction = \"local_student_delete\";\n\n        let url = new URL(\"http://localhost/moodle/webservice/rest/server.php\");\n        let params = {\n          id,\n          wstoken: api_key,\n          wsfunction,\n          moodlewsrestformat: \"json\",\n        };\n        url.search = new URLSearchParams(params).toString();\n        fetch(url, {\n          method: \"GET\",\n        })\n          .then((respose) => {\n            if (!respose.ok) {\n              throw Error(\"Database operation failed!\");\n            }\n            return respose.json();\n          })\n          .then((data) => {\n            window.location.reload();\n            return data;\n          })\n          .catch((e) => {\n            alert(e.message);\n          });\n      });\n      modal.show();\n    });\n  });\n};\n"],"names":["async","api_key","then","data","on","e","id","Number","parseInt","target","text","split","create","type","ModalFactory","types","SAVE_CANCEL","title","body","modal","setSaveButtonText","getRoot","ModalEvents","save","url","URL","params","wstoken","wsfunction","moodlewsrestformat","search","URLSearchParams","toString","fetch","method","respose","ok","Error","json","window","location","reload","catch","alert","message","show"],"mappings":"keAKoBA,cACdC,cACE,mBAAW,YAAa,iBAAiBC,MAAMC,OACnDF,QAAUE,4BAEV,0BAA0BC,GAAG,SAAUC,QACnCC,GAAKC,OAAOC,SAASH,EAAEI,OAAOC,KAAKC,MAAM,KAAK,2BAErCC,OAAO,CAClBC,KAAMC,uBAAaC,MAAMC,YACzBC,MAAO,iBACPC,KAAM,uCACLhB,MAAMiB,QACPA,MAAMC,kBAAkB,UACbD,MAAME,UAEZjB,GAAGkB,sBAAYC,MAAM,SAGpBC,IAAM,IAAIC,IAAI,sDACdC,OAAS,CACXpB,GAAAA,GACAqB,QAAS1B,QACT2B,WANe,uBAOfC,mBAAoB,QAEtBL,IAAIM,OAAS,IAAIC,gBAAgBL,QAAQM,WACzCC,MAAMT,IAAK,CACTU,OAAQ,QAEPhC,MAAMiC,cACAA,QAAQC,SACLC,MAAM,qCAEPF,QAAQG,UAEhBpC,MAAMC,OACLoC,OAAOC,SAASC,SACTtC,QAERuC,OAAOrC,IACNsC,MAAMtC,EAAEuC,eAGdzB,MAAM0B"}